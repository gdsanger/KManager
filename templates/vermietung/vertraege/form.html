{% extends "vermietung/layouts/form_layout.html" %}
{% load l10n %}

{% block title %}{% if is_create %}Neuer Vertrag{% else %}Vertrag bearbeiten{% endif %} - Domus{% endblock %}

{% block page_title %}
{% if is_create %}
    <i class="bi bi-plus-circle"></i> Neuer Vertrag
{% else %}
    <i class="bi bi-pencil"></i> Vertrag bearbeiten: {{ vertrag.vertragsnummer }}
{% endif %}
{% endblock %}

{% block page_actions %}
<a href="{% if is_create %}{% url 'vermietung:vertrag_list' %}{% else %}{% url 'vermietung:vertrag_detail' vertrag.pk %}{% endif %}" class="btn btn-secondary">
    <i class="bi bi-x-circle"></i> Abbrechen
</a>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-body">
                <form method="post" id="vertragForm">
                    {% csrf_token %}
                    
                    {% if form.non_field_errors %}
                    <div class="alert alert-danger" role="alert">
                        {{ form.non_field_errors }}
                    </div>
                    {% endif %}

                    <h5 class="mb-3"><i class="bi bi-file-earmark-text"></i> Vertragsdaten</h5>
                    
                    <div class="mb-3">
                        <label for="{{ form.vertragsnummer.id_for_label }}" class="form-label">{{ form.vertragsnummer.label }}</label>
                        {{ form.vertragsnummer }}
                        {% if form.vertragsnummer.errors %}
                        <div class="text-danger small">{{ form.vertragsnummer.errors }}</div>
                        {% endif %}
                        {% if form.vertragsnummer.help_text %}
                        <div class="form-text">{{ form.vertragsnummer.help_text }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.mieter.id_for_label }}" class="form-label">{{ form.mieter.label }}</label>
                        {{ form.mieter }}
                        {% if form.mieter.errors %}
                        <div class="text-danger small">{{ form.mieter.errors }}</div>
                        {% endif %}
                        {% if form.mieter.help_text %}
                        <div class="form-text">{{ form.mieter.help_text }}</div>
                        {% endif %}
                    </div>

                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-building"></i> Objekte</h5>
                    
                    {{ formset.management_form }}
                    {% if formset.non_form_errors %}
                    <div class="alert alert-danger" role="alert">
                        {{ formset.non_form_errors }}
                    </div>
                    {% endif %}
                    
                    <div class="table-responsive">
                        <table class="table table-sm" id="vertragsobjekte-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">Mietobjekt *</th>
                                    <th style="width: 15%;">Preis (€) *</th>
                                    <th style="width: 10%;">Anzahl *</th>
                                    <th style="width: 15%;">Zugang</th>
                                    <th style="width: 15%;">Abgang</th>
                                    <th style="width: 12%;">Status *</th>
                                    <th style="width: 8%;">Löschen</th>
                                </tr>
                            </thead>
                            <tbody id="formset-body">
                                {% for form in formset %}
                                <tr class="formset-row">
                                    <td>
                                        {{ form.id }}
                                        {{ form.mietobjekt }}
                                        {% if form.mietobjekt.errors %}
                                        <div class="text-danger small">{{ form.mietobjekt.errors }}</div>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ form.preis }}
                                        {% if form.preis.errors %}
                                        <div class="text-danger small">{{ form.preis.errors }}</div>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ form.anzahl }}
                                        {% if form.anzahl.errors %}
                                        <div class="text-danger small">{{ form.anzahl.errors }}</div>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ form.zugang }}
                                        {% if form.zugang.errors %}
                                        <div class="text-danger small">{{ form.zugang.errors }}</div>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ form.abgang }}
                                        {% if form.abgang.errors %}
                                        <div class="text-danger small">{{ form.abgang.errors }}</div>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ form.status }}
                                        {% if form.status.errors %}
                                        <div class="text-danger small">{{ form.status.errors }}</div>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        {{ form.DELETE }}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <button type="button" class="btn btn-sm btn-secondary" id="add-row">
                        <i class="bi bi-plus-circle"></i> Weiteres Mietobjekt hinzufügen
                    </button>
                    
                    <div class="mt-3">
                        <strong>Gesamtmiete: <span id="gesamtmiete">0.00</span> €</strong>
                        <small class="text-muted d-block">Wird automatisch berechnet aus: Σ(Anzahl × Preis)</small>
                    </div>

                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-calendar-range"></i> Vertragszeitraum</h5>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.start.id_for_label }}" class="form-label">{{ form.start.label }}</label>
                            {{ form.start }}
                            {% if form.start.errors %}
                            <div class="text-danger small">{{ form.start.errors }}</div>
                            {% endif %}
                            {% if form.start.help_text %}
                            <div class="form-text">{{ form.start.help_text }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.ende.id_for_label }}" class="form-label">{{ form.ende.label }}</label>
                            {{ form.ende }}
                            {% if form.ende.errors %}
                            <div class="text-danger small">{{ form.ende.errors }}</div>
                            {% endif %}
                            {% if form.ende.help_text %}
                            <div class="form-text">{{ form.ende.help_text }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-currency-euro"></i> Finanzielle Konditionen</h5>
                    
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <div class="form-check">
                                {{ form.auto_total }}
                                <label class="form-check-label" for="{{ form.auto_total.id_for_label }}">
                                    {{ form.auto_total.label }}
                                </label>
                                {% if form.auto_total.errors %}
                                <div class="text-danger small">{{ form.auto_total.errors }}</div>
                                {% endif %}
                                {% if form.auto_total.help_text %}
                                <div class="form-text">{{ form.auto_total.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row" id="auto-total-section">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.miete.id_for_label }}" class="form-label">{{ form.miete.label }}</label>
                            <div class="input-group">
                                {{ form.miete }}
                                <span class="input-group-text">€</span>
                            </div>
                            {% if form.miete.errors %}
                            <div class="text-danger small">{{ form.miete.errors }}</div>
                            {% endif %}
                            {% if form.miete.help_text %}
                            <div class="form-text">{{ form.miete.help_text }}</div>
                            {% endif %}
                            <small class="text-muted d-block mt-1">
                                <i class="bi bi-info-circle"></i> Automatisch berechnet aus Positionen
                            </small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.umsatzsteuer_satz.id_for_label }}" class="form-label">{{ form.umsatzsteuer_satz.label }}</label>
                            {{ form.umsatzsteuer_satz }}
                            {% if form.umsatzsteuer_satz.errors %}
                            <div class="text-danger small">{{ form.umsatzsteuer_satz.errors }}</div>
                            {% endif %}
                            {% if form.umsatzsteuer_satz.help_text %}
                            <div class="form-text">{{ form.umsatzsteuer_satz.help_text }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row" id="manual-total-section" style="display: none;">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.manual_net_total.id_for_label }}" class="form-label">{{ form.manual_net_total.label }}</label>
                            <div class="input-group">
                                {{ form.manual_net_total }}
                                <span class="input-group-text">€</span>
                            </div>
                            {% if form.manual_net_total.errors %}
                            <div class="text-danger small">{{ form.manual_net_total.errors }}</div>
                            {% endif %}
                            {% if form.manual_net_total.help_text %}
                            <div class="form-text">{{ form.manual_net_total.help_text }}</div>
                            {% endif %}
                            <small class="text-muted d-block mt-1">
                                <i class="bi bi-exclamation-triangle"></i> Überschreibt die Summe der Positionen
                            </small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.umsatzsteuer_satz.id_for_label }}" class="form-label">{{ form.umsatzsteuer_satz.label }}</label>
                            {{ form.umsatzsteuer_satz }}
                            {% if form.umsatzsteuer_satz.errors %}
                            <div class="text-danger small">{{ form.umsatzsteuer_satz.errors }}</div>
                            {% endif %}
                            {% if form.umsatzsteuer_satz.help_text %}
                            <div class="form-text">{{ form.umsatzsteuer_satz.help_text }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.stellplatzbetrag.id_for_label }}" class="form-label">{{ form.stellplatzbetrag.label }}</label>
                            <div class="input-group">
                                {{ form.stellplatzbetrag }}
                                <span class="input-group-text">€</span>
                            </div>
                            {% if form.stellplatzbetrag.errors %}
                            <div class="text-danger small">{{ form.stellplatzbetrag.errors }}</div>
                            {% endif %}
                            {% if form.stellplatzbetrag.help_text %}
                            <div class="form-text">{{ form.stellplatzbetrag.help_text }}</div>
                            {% endif %}
                            <small class="text-muted d-block mt-1">
                                <i class="bi bi-info-circle"></i> Wird zur Gesamtsumme addiert
                            </small>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <div class="row mb-2">
                                        <div class="col-6 text-muted">
                                            Nettobetrag:
                                            <span id="netto-source-hint" class="badge bg-secondary ms-2" style="font-size: 0.7em;"></span>
                                        </div>
                                        <div class="col-6 text-end"><span id="nettobetrag-display">0.00</span> €</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-6 text-muted">Umsatzsteuer (<span id="ust-satz-display">19</span>%):</div>
                                        <div class="col-6 text-end"><span id="umsatzsteuer-display">0.00</span> €</div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="col-6"><strong>Bruttobetrag:</strong></div>
                                        <div class="col-6 text-end"><strong><span id="bruttobetrag-display">0.00</span> €</strong></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="{{ form.kaution.id_for_label }}" class="form-label">{{ form.kaution.label }}</label>
                            <div class="input-group">
                                {{ form.kaution }}
                                <span class="input-group-text">€</span>
                            </div>
                            {% if form.kaution.errors %}
                            <div class="text-danger small">{{ form.kaution.errors }}</div>
                            {% endif %}
                            {% if form.kaution.help_text %}
                            <div class="form-text">{{ form.kaution.help_text }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <hr class="my-4">
                    <h5 class="mb-3"><i class="bi bi-info-circle"></i> Status & Mandant</h5>
                    
                    <div class="mb-3">
                        <label for="{{ form.status.id_for_label }}" class="form-label">{{ form.status.label }}</label>
                        {{ form.status }}
                        {% if form.status.errors %}
                        <div class="text-danger small">{{ form.status.errors }}</div>
                        {% endif %}
                        {% if form.status.help_text %}
                        <div class="form-text">{{ form.status.help_text }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.mandant.id_for_label }}" class="form-label">{{ form.mandant.label }}</label>
                        {{ form.mandant }}
                        {% if form.mandant.errors %}
                        <div class="text-danger small">{{ form.mandant.errors }}</div>
                        {% endif %}
                        {% if form.mandant.help_text %}
                        <div class="form-text">{{ form.mandant.help_text }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Speichern
                        </button>
                        <a href="{% if is_create %}{% url 'vermietung:vertrag_list' %}{% else %}{% url 'vermietung:vertrag_detail' vertrag.pk %}{% endif %}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Abbrechen
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Sidebar with help text -->
    <div class="col-lg-4">
        <div class="card mb-3">
            <div class="card-header">
                <i class="bi bi-chat-left-text"></i> Bemerkung
            </div>
            <div class="card-body">
                <label for="{{ form.bemerkung.id_for_label }}" class="form-label">{{ form.bemerkung.label }}</label>
                {{ form.bemerkung }}
                {% if form.bemerkung.errors %}
                <div class="text-danger small">{{ form.bemerkung.errors }}</div>
                {% endif %}
                {% if form.bemerkung.help_text %}
                <div class="form-text">{{ form.bemerkung.help_text }}</div>
                {% endif %}
            </div>
        </div>
        
        <div class="card mb-3">
            <div class="card-header">
                <i class="bi bi-info-circle"></i> Hinweise
            </div>
            <div class="card-body">
                <p class="text-muted small mb-2">
                    <strong>Vertragsnummer:</strong> Kann manuell eingegeben werden, oder wird automatisch beim Speichern generiert (Format: V-00000), wenn das Feld leer bleibt.
                </p>
                <p class="text-muted small mb-2">
                    <strong>Objekte:</strong> Fügen Sie die zu vermietenden Objekte in der Tabelle hinzu. Sie können für jedes Objekt Preis, Anzahl, Zugangs- und Abgangsdatum sowie den Status festlegen.
                </p>
                <p class="text-muted small mb-2">
                    <strong>Gesamtmiete:</strong> Wird automatisch aus der Summe von (Anzahl × Preis) aller Objekte berechnet.
                </p>
                <p class="text-muted small mb-2">
                    <strong>Mieter:</strong> Nur Adressen vom Typ "Kunde" können als Mieter ausgewählt werden.
                </p>
                <p class="text-muted small mb-2">
                    <strong>Zeitraum:</strong> Der Vertragsbeginn ist Pflicht. Das Enddatum ist optional (leer = unbefristet).
                </p>
                <p class="text-muted small mb-0">
                    <strong>Verfügbarkeit:</strong> Die Verfügbarkeit der Objekte wird automatisch basierend auf aktiven Verträgen aktualisiert.
                </p>
            </div>
        </div>

        {% if not is_create %}
        <div class="card">
            <div class="card-header">
                <i class="bi bi-gear"></i> Aktionen
            </div>
            <div class="card-body">
                <p class="text-muted small mb-2">
                    Zum Beenden oder Stornieren des Vertrags verwenden Sie die entsprechenden Aktionen auf der Detailseite.
                </p>
                <a href="{% url 'vermietung:vertrag_detail' vertrag.pk %}" class="btn btn-sm btn-outline-info w-100">
                    <i class="bi bi-eye"></i> Zur Detailseite
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Formset management
const formsetBody = document.getElementById('formset-body');
const addButton = document.getElementById('add-row');
const totalFormsInput = document.getElementById('id_vertragsobjekte-TOTAL_FORMS');
const mieteField = document.getElementById('id_miete');
const gesamtmieteDisplay = document.getElementById('gesamtmiete');
const umsatzsteuerSatzSelect = document.getElementById('id_umsatzsteuer_satz');
const nettobetragsDisplay = document.getElementById('nettobetrag-display');
const umsatzsteuerDisplay = document.getElementById('umsatzsteuer-display');
const ustSatzDisplay = document.getElementById('ust-satz-display');
const bruttobetragsDisplay = document.getElementById('bruttobetrag-display');
const nettoSourceHint = document.getElementById('netto-source-hint');

// Flat rate fields
const autoTotalCheckbox = document.getElementById('id_auto_total');
const manualNetTotalField = document.getElementById('id_manual_net_total');
const stellplatzbetragField = document.getElementById('id_stellplatzbetrag');
const autoTotalSection = document.getElementById('auto-total-section');
const manualTotalSection = document.getElementById('manual-total-section');

// Get mietobjekt price data for auto-filling
const mietobjektPreise = {
    {% for obj in formset.form.base_fields.mietobjekt.queryset %}
    {{ obj.pk }}: {% if obj.mietpreis %}{{ obj.mietpreis|unlocalize }}{% else %}null{% endif %}{% if not forloop.last %},{% endif %}
    {% endfor %}
};

function toggleTotalMode() {
    const isAutoTotal = autoTotalCheckbox.checked;
    
    if (isAutoTotal) {
        // Show auto section, hide manual section
        autoTotalSection.style.display = '';
        manualTotalSection.style.display = 'none';
        manualNetTotalField.removeAttribute('required');
        manualNetTotalField.setAttribute('disabled', 'disabled');
        
        // Update calculations from line items
        updateGesamtmiete();
    } else {
        // Show manual section, hide auto section
        autoTotalSection.style.display = 'none';
        manualTotalSection.style.display = '';
        manualNetTotalField.removeAttribute('disabled');
        
        // Update calculations from manual field
        updateManualTotalCalculations();
    }
}

function updateGesamtmiete() {
    let total = 0;
    
    // Calculate total from all non-deleted rows
    document.querySelectorAll('.formset-row').forEach(row => {
        const deleteCheckbox = row.querySelector('input[name$="-DELETE"]');
        if (deleteCheckbox && deleteCheckbox.checked) {
            return; // Skip deleted rows
        }
        
        const preisInput = row.querySelector('.preis-input');
        const anzahlInput = row.querySelector('.anzahl-input');
        
        if (preisInput && anzahlInput) {
            const preis = parseFloat(preisInput.value) || 0;
            const anzahl = parseInt(anzahlInput.value) || 0;
            total += preis * anzahl;
        }
    });
    
    // Update display and hidden field
    gesamtmieteDisplay.textContent = total.toFixed(2);
    if (mieteField) {
        mieteField.value = total.toFixed(2);
    }
    
    // Only update VAT if in auto mode
    if (autoTotalCheckbox.checked) {
        // Add stellplatzbetrag to total
        const stellplatzbetrag = parseFloat(stellplatzbetragField.value) || 0;
        const effectiveTotal = total + stellplatzbetrag;
        updateVATCalculations(effectiveTotal, 'Auto');
    }
}

function updateManualTotalCalculations() {
    const manualTotal = parseFloat(manualNetTotalField.value) || 0;
    const stellplatzbetrag = parseFloat(stellplatzbetragField.value) || 0;
    const effectiveTotal = manualTotal + stellplatzbetrag;
    updateVATCalculations(effectiveTotal, 'Manuell');
}

function updateVATCalculations(nettobetrag, source) {
    // Get selected VAT rate
    const ustSatz = parseFloat(umsatzsteuerSatzSelect.value) || 0;
    
    // Calculate VAT amount with proper rounding for financial calculations
    // Multiply by 100 first, then divide to avoid floating point precision issues
    const umsatzsteuer = Math.round(nettobetrag * ustSatz) / 100;
    
    // Calculate gross amount
    const bruttobetrag = nettobetrag + umsatzsteuer;
    
    // Update displays
    nettobetragsDisplay.textContent = nettobetrag.toFixed(2);
    umsatzsteuerDisplay.textContent = umsatzsteuer.toFixed(2);
    ustSatzDisplay.textContent = ustSatz.toFixed(0);
    bruttobetragsDisplay.textContent = bruttobetrag.toFixed(2);
    
    // Update source hint badge
    if (source) {
        nettoSourceHint.textContent = source;
    }
}

function setupRowEventListeners(row) {
    // Update total when price or quantity changes
    const preisInput = row.querySelector('.preis-input');
    const anzahlInput = row.querySelector('.anzahl-input');
    const mietobjektSelect = row.querySelector('.mietobjekt-select');
    const deleteCheckbox = row.querySelector('input[name$="-DELETE"]');
    
    if (preisInput) {
        preisInput.addEventListener('input', updateGesamtmiete);
    }
    if (anzahlInput) {
        anzahlInput.addEventListener('input', updateGesamtmiete);
    }
    if (deleteCheckbox) {
        deleteCheckbox.addEventListener('change', updateGesamtmiete);
    }
    
    // Auto-fill price when mietobjekt is selected
    if (mietobjektSelect) {
        mietobjektSelect.addEventListener('change', function() {
            const selectedId = this.value;
            if (selectedId && mietobjektPreise[selectedId] && preisInput) {
                preisInput.value = mietobjektPreise[selectedId];
                updateGesamtmiete();
            }
        });
    }
}

// Setup existing rows
document.querySelectorAll('.formset-row').forEach(setupRowEventListeners);

// Add new row functionality
if (addButton) {
    addButton.addEventListener('click', function() {
        const totalForms = parseInt(totalFormsInput.value);
        const lastRow = formsetBody.querySelector('.formset-row:last-child');
        
        // Check if there are existing rows to clone
        if (!lastRow) {
            console.error('No formset rows available to clone');
            alert('Fehler: Keine Vorlage zum Hinzufügen einer neuen Zeile verfügbar.');
            return;
        }
        
        const newRow = lastRow.cloneNode(true);
        
        // Update form index in all fields
        newRow.innerHTML = newRow.innerHTML.replace(
            /vertragsobjekte-\d+-/g,
            `vertragsobjekte-${totalForms}-`
        );
        newRow.innerHTML = newRow.innerHTML.replace(
            /vertragsobjekte-\d+/g,
            `vertragsobjekte-${totalForms}`
        );
        
        // Clear values
        newRow.querySelectorAll('input:not([type="checkbox"]):not([type="hidden"])').forEach(input => {
            input.value = '';
        });
        newRow.querySelectorAll('select').forEach(select => {
            select.selectedIndex = 0;
        });
        newRow.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = false;
        });
        
        // Set default values
        const anzahlInput = newRow.querySelector('.anzahl-input');
        if (anzahlInput) {
            anzahlInput.value = '1';
        }
        
        // Append new row
        formsetBody.appendChild(newRow);
        
        // Update total forms count
        totalFormsInput.value = totalForms + 1;
        
        // Setup event listeners for new row
        setupRowEventListeners(newRow);
        
        // Update gesamtmiete
        updateGesamtmiete();
    });
}

// Setup auto_total toggle event listener
if (autoTotalCheckbox) {
    autoTotalCheckbox.addEventListener('change', toggleTotalMode);
    
    // Initialize the correct mode on page load
    toggleTotalMode();
}

// Setup manual net total input event listener
if (manualNetTotalField) {
    manualNetTotalField.addEventListener('input', function() {
        if (!autoTotalCheckbox.checked) {
            updateManualTotalCalculations();
        }
    });
}

// Setup stellplatzbetrag input event listener
if (stellplatzbetragField) {
    stellplatzbetragField.addEventListener('input', function() {
        if (autoTotalCheckbox.checked) {
            updateGesamtmiete();
        } else {
            updateManualTotalCalculations();
        }
    });
}

// Calculate initial total
updateGesamtmiete();

// Update VAT calculations when VAT rate changes
if (umsatzsteuerSatzSelect) {
    umsatzsteuerSatzSelect.addEventListener('change', function() {
        if (autoTotalCheckbox.checked) {
            // Recalculate with current auto total
            updateGesamtmiete();
        } else {
            // Recalculate with current manual total
            updateManualTotalCalculations();
        }
    });
}
</script>
{% endblock %}
