{% extends "vermietung/layouts/list_layout.html" %}
{% load django_tables2 %}

{% block title %}Eingangsrechnungen - Domus{% endblock %}

{% block page_title %}Eingangsrechnungen{% endblock %}

{% block page_actions %}
<div class="btn-group" role="group">
    <a href="{% url 'vermietung:eingangsrechnung_create_from_pdf' %}" class="btn btn-success">
        <i class="bi bi-file-earmark-pdf"></i> Aus PDF erstellen
    </a>
    <a href="{% url 'vermietung:eingangsrechnung_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Manuell erstellen
    </a>
</div>
{% endblock %}

{% block filters %}
<div class="row mb-3">
    <div class="col-md-12">
        <form method="get" action="{% url 'vermietung:eingangsrechnung_list' %}">
            <div class="row g-2">
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text">
                            <i class="bi bi-search"></i>
                        </span>
                        {{ filter.form.q }}
                    </div>
                </div>
                <div class="col-md-2">
                    {{ filter.form.status }}
                </div>
                <div class="col-md-2">
                    {{ filter.form.mietobjekt }}
                </div>
                <div class="col-md-2">
                    {{ filter.form.umlagefaehig }}
                </div>
                <div class="col-md-2">
                    <div class="btn-group w-100" role="group">
                        <button type="submit" class="btn btn-outline-secondary">
                            <i class="bi bi-funnel"></i> Filter
                        </button>
                        {% if request.GET %}
                        <a href="{% url 'vermietung:eingangsrechnung_list' %}" class="btn btn-outline-secondary" title="Filter zurücksetzen">
                            <i class="bi bi-x"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Date Range Filters (Optional - can be collapsed) -->
            <div class="row g-2 mt-2">
                <div class="col-md-3">
                    <label for="{{ filter.form.belegdatum_von.id_for_label }}" class="form-label small">{{ filter.form.belegdatum_von.label }}</label>
                    {{ filter.form.belegdatum_von }}
                </div>
                <div class="col-md-3">
                    <label for="{{ filter.form.belegdatum_bis.id_for_label }}" class="form-label small">{{ filter.form.belegdatum_bis.label }}</label>
                    {{ filter.form.belegdatum_bis }}
                </div>
            </div>
        </form>
    </div>
</div>
<div class="row mb-2">
    <div class="col text-end">
        <span class="text-muted">{{ table.paginator.count }} Rechnung{{ table.paginator.count|pluralize:"en" }}</span>
    </div>
</div>
{% endblock %}

{% block table_content %}
<div class="table-responsive">
    {% render_table table %}
</div>
{% endblock %}

{% block pagination %}
{# Pagination is handled by django-tables2 #}
{% endblock %}

{% block extra_js %}
<script>
function confirmDelete(belegnummer, deleteUrl) {
    if (confirm('Möchten Sie die Eingangsrechnung "' + belegnummer + '" wirklich löschen?')) {
        var form = document.createElement('form');
        form.method = 'POST';
        form.action = deleteUrl;
        
        var csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
        if (!csrfToken) {
            csrfToken = document.createElement('input');
            csrfToken.type = 'hidden';
            csrfToken.name = 'csrfmiddlewaretoken';
            csrfToken.value = '{{ csrf_token }}';
            form.appendChild(csrfToken);
        } else {
            form.appendChild(csrfToken.cloneNode());
        }
        
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
